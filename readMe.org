* mobius transformations
** idea
   algebra and geometry of
   the extended complex numbers and
   linear fractional transformations

   geometric objects:
   points lines circles triangles
   and their images under application of linear fractional transformations

   two complex planes
   pre-image and image

   stereographic projection
   the extended complex plane
   and the Reiman sphere
   in perspective

** app behavior
   app is either in mouse mode or animation mode
   in animation mode, mouse mode is disabled

   display elements are rendered one at a time
   on top of each other

   animate button will render everything in render list,
   in order added, one element at a time
   using an offscreen buffer to redraw
   everything in render list quickly

   in mouse mode, render list is displayed first
   then mouse position, kept in local state, is displayed

   mouse mode used to create objects to be added to render list

   elements in render list consist of
   predifined elements including
   axis, unit circle,
   rectangular grid lines
   concentric circles about origin
   radial lines through origin

   custom elements defined through mouse mode
   and then added to render list

   render list should be viewable and editable

   switching transforms shoud triger either
   an animated redraw or an instant redraw

   once a render list is created,
   one could save as an svg or
   save as data and send to server,
   or save on local file system

** implementation
*** vector
    in vector.cljs
    algebraic operations for vectors and matrices

    sum product
    scal-mul
    dot
    len len-sq
    angle
    midpoint
    mvmult
    mmmult
    mat-inverse

*** complex number
    in complex.cljs

    represented as
    a vector of two rational numbers
    [x y] or [r a]
    with the possibility of being infinity
    where 1/zero = infinity and 1/infinity = zero
    and zero/zero = infinity/infinity = undefined

    complex numbers can be added, multiplied and conjugated
    they have a length and an angle

*** linear fractional transformation
    in trasnforms.cljs

    represented as
    a vector of four complex numbers
    [a b c d]
    that can be normalized so that
    ad - bc = 1
    has a determinant, trace, inverse
    can be composed and conjugated

    translation rotation scaling inversion
    all represented as 4-vectors of complex number

    composition of transformation implemented as
    matrix multipliation of 2x2 complex matrices

    inverse of a transformation as inverse of a 2x2 matrix
    conjugation by a conjugataing map as composition
    of three matrices

*** image of a generalized circle
    image of a circle from
    Grandma's recipe and project 3.7 in Indra's Pearls

    my idea:
    image of a line
    line represented by two points
    look at image of the two points and of their midpoint
    they are either collieanr,
    in which case the image of the line is a line
    or they form a triangle,
    in which case the image of the line is a circle,
    the circumcircle of the triangle

    so what is the circumcircle of a triangle?
    the circumcenter is the intesection of the perpendicualr bisectors
    the radius is the distance
    from the circumcenter
    to one of the vertices of the triangle
    see illuminated triangle

    todo:
    look at method from geometry of complex numbers
    where a generalized circle is repsesented as a Hermitian matrix

*** drawing to canvas
    draw.cljs
    basic geometric primitives of
    point line triangle circle rect
    style

    rendered to a canvas context
    by sending data to a care.async channel

    a drawing-loop channel
    that renders recieved messages to a graphics context

    larger geometric objects
    constructed from a sequence of basic primitives

*** handling of events
    mouse click and move events put on events channel
    handled by an event handler
    with a control channel to start and stop

*** technologies used
    om, react
    core.match
    core.async channels
    transducers
    data representing geometric entities
    html, canvas, css
    svg (not yet implemented)
    clojurescript, cljsbuild, figwheel, brepl

** math references
   Introduction to Geometry
   Coxeter

   Indra's Pearls
   The vision of Felix Klein
   Mumford, Series, Wright

   Visual Complex Analysis
   Tristan Needham

   Geometry of Complex Numbers
   Hans Schwerdttfeger

   Introduction to the
   Geometry of Complex Numbers
   Roland Deaux

** next steps
*** DONE generalized circles
    CLOSED: [2015-06-14 Sun 16:58]
    calculate image of a
    generalized circle
    under any linear fractional transformation

    create representation of
    a generalized circle
    as a Hermitian matrix

*** polar and rectanglar interactive modes
    when mouse is in pre-image canvas
    draw line through mouse and origin
    and circle centered at origin through mouse point
    when in polar mode

    or vertical and horizontal lines through mouse point
    when in rectangular mode

    lines and/or circles in pre-image canvas
    are drawn simultaneously in image canvas
    updated in both canvases as mouse moves

    lcoal state
    :mouse-mode :polar :reactangular
    :mouse-point

    events channel: mouse-move, mouse-click
    control channel: to start and stop mode
    screen->user: to convert screen space to user space

    render list - list of things to be rendered
    :axis :radial-lines :concentric-circles
    :horizontal-lines :vertical-lines

    animating-mode
    while in animating mode, temporarily disable mouse mode
    indicate visually that an animation is in place

    separate drawing data from animation
    allowing for quick redrawing while in mouse-mode

    animation button clicks add animations to the render-list
    clear removes them

*** interactive mouse modes
    modes for creating objects
    or for viewing properties

    make lines circles, triangles, quadrangles
    using mouse

    view properties such as
    orthogonal circles with two given centers
    where the third point varies along the circle
    with diameter equal to line between the two centers

    perpendicular bisectors of a line or of three lines of a triangle

    circumcircle through three points
    where two points are fixed and the third varies

    guides exist to make special objects like
    isosceles triangles
    equilateral triangles
    right triangles
    circumcircle of a triangle
    families of orthogonal circles (generalized)
    radial lines, paralell lines, concentric circles
    circles tangent to a point
    circles through two points

    the way it workd os like this:
    local state contains current mouse-mode state
    events update the state
    in mouse-mode,
    render draws the background from the app-state
    and then the current mouse state on top

    each mouse event triggers such a redraw

    events include :move :click
    :click could be a :mouse-down
    followed by a :mouse-up
    but for now, it is just a :mosue-down

    now, while animating, we want to disable mouse mode,
    this is because we are really focused on the animation
    and the drawing mode is just one on top of the previous,
    in sequence, with out redrawing - this could change,
    but for now it is the way it is

*** grandma's recipes
    add more linear fractional transformations,
    as found in Grandma's recipies

    those that
    - preserve the real line
    - preserve the unit circle, disk
    - preserve the upper half plane
    - pair circles

    - are loxodromic
    - are elliptic
    - are hyperbolic
    - are parabolic

*** allow for input of arbitrary linear fractional transformation
    and switching between a list of transforms, and adding new ones to the list

    allow for input of arbitrary complex number
    in polar and rectangular form
    - as [x y] -> x + iy
    - as [r a] -> r*exp(i*a)
    - as named complex numbers:
      zero one i infity w1
    - as operations on existing complex number
      minus recip conjugate
      and compositions thereof

    allow for input of linear fractional transformations
    by selection from a list or by entering 4 complex numbers

*** show properties of the transformation
    entries a b c d
    determinant
    trace
    inverse
    fixed points

*** allow for conjugation
    with translation, rotation, scaling
*** DONE add unit tests
    CLOSED: [2015-06-18 Thu 10:28]
    unit
*** add more comprehensive unit tests
    clojurescript testing
    https://github.com/clojure/clojurescript/wiki/Testing

*** add test.check
    generative tests
    test properties

    0.7.0
    https://github.com/clojure/test.check

*** add schema contracts
    for dicumentation and testing

    (require '[schema.core :as s :include-macros true])
    (doc schema.core)

    namespace documentation

    blog:
    http://blog.getprismatic.com/schema-for-clojurescript-data-shape-declaration-and-validation/
    docs:
    http://prismatic.github.io/schema/

    github:
    https://github.com/Prismatic/schema


    #+BEGIN_SRC clojure
      (def Point [s/Num])
      (def Circle "a schema for circles" {:center Point :radius s/Num})

      (s/check Circle {:center [0 0] :radius 1})
      (s/validate Circle {:center [0 0] :radius 1})

      (def circle [(s/one s/Keyword "tag") (s/one Circle "data")])
      (s/check circle [:circle {:center [0 0] :radius 1}])
    #+END_SRC

    how to describe [:triangle p1 p2 p3]

    for instance
    a point is a single complex number
    a line, two complex numbers
    a triangle made up of three complex numbers,
    if not collinear, has a circumcircle - a circumcenter and a radius
    a transform can be applied to a point a line or a triangle
    and consists of complex addition and multiplication
    along with subtraction and division
    with refelction and inversion using the complex conjugate

*** contracts as types
    https://github.com/jessitron/contracts-as-types-examples/blob/master/test/contractypes/report_example_test.clj
    https://github.com/jessitron/contracts-as-types-examples
    https://github.com/jessitron/schematron

    Philly ETE 2015 #4
    Contracts & Clojure: The Best-Yet Compromise of Types and Tests
    Jessica Kerr
    https://www.youtube.com/watch?v=GFQqyXoL0YQ
    http://www.slideshare.net/jessitron/contracts-inclojurepete

    david mcneil extending prismatic schema to higher order
    http://david-mcneil.com/post/114783282473/extending-prismatic-schema-to-higher-order
    https://gist.github.com/david-mcneil/a46b091c05a91adb8336

*** get transit working
    round trip some data
*** add complex sqrt
    with tests
*** re factor draw
    into canvas specific stuff
    and mobius stuff
    add svg impementation

*** extend line segment
    line between two points
    should sometimes be extended to a whole line

    would be nice to be able to distinguish the three parts
    given two points, p1 p2,
    the three parts are
    the finite segment p1 to p2
    the infinite segments
    from infinity to p1 and
    from p2 to infinity

    and then the image of the three parts
    could also be distinguished

    as an example, consider mouse-mode, rectangular
    the vertical line consists of
    point to real axis
    and then to infinity
    and from point to infinity
    and simalarly for horizontal lines but with imaginary axis
*** three points make a circle
    the circumcircle of a triangle, if not collinear

    when the image of a line is a circle,
    the three points of the image circle are
    images of p1 p2 and infinity
    and just as the lien between two points makes three segments
    so does the image circle of a line
    that is, three corresponding arcs of a circle

    an example is under the Cayley transformation,
    in mouse-mode, polar, the line from the mouse point through the origin
    the three points are the origin, the mouse point, and infinity
    the line should have three distinctive parts
    as well as its image
    whether its image is a line or a circle

    0 1 i
    line 0 1 -> unit circle
    line 0 i -> real axis
    infinity -> one
    unit circle -> imaginary axis

    circles inside unit circle
    circles outside unit circle

    see how a line is really just a circle of infinite radius
*** express circle by three points
    as an alternative representation,
    in addition to center radius representation
    a circle can be represented by three points
    that is the circumcirlce of the triangle
    consisting of the three given points

    in case the three points are colliner,
    then the circle is really a line,
    which is a circle in the generalized sense

*** parameterized circle
    z = (at + b)/(ct + d)
    generalized equation
    z*zbar + a*z + abar*zbar + b = 0
    center = -abar
    radius = a*abar - b

    example: z = (1 + it)/(1 - it)
    z1 z0 zinfinity

    constructed and
    calibrated

    see Deaux

*** geometry and complex numbers
    including infinity
    circle through infinity is a line
*** define the terms
    complex number
    addition, multiplication, one, zero
    subtraction, multiplication
    length angle
    point line triangle circle
    basic operations
    translation, dilation
    reflection - in a line or a circle

    transforms using + - * / bar
    circle preserving transformations
    orientation, preserving and reversing

*** describe the data
    tell a story

    two paths
    one using reords and extend-type
    another vectors and core.match

    so what is he relevant data here?
    primitive types: point line circle triangle style
    to be combined in a sequence to be rendered to the canvas
    or, eventually, to svg

    to be able to animate illustrations,
    illuminate ideas

    geoemtric types with style
    number types with algebraic operations
    addition and multiplication
    complex number

    transformation types
    that can be compoesed, conjugated
    have inverses
    and preserve generalized circles

    generalized circles
    a circle or a line
    can be transformed
    and, with some style, rendered

    families of circles, pencils
    and orthogonal compliments
    images of pencils

    basic transformations
    applied to
    unit circle
    real axis

    translation and dilation
    addition and multiplication

    geomtric data assiciated with a transform
    to illustrate that transform

    ability to create data and save or
    pass it to the server
    store it in a data base
    comment on it and share it
    or save it locally to the file system
    evenually synching with db
*** play of game
    basic objects ad operations
    transforamtion geometry
    using complex number
    making more complex things form simple ones

    classifying all modius transformations
    generate pencils of circles, generalized cirles
    along with orthogonal compliments
    just using an axis and a circle with
    translation and dilation,
    which in turn uses addition and multiplication
    of complex numbers and their inverses

    define a set of terms
    which are used throughout,
    illustrated by example
    implemented in code
    as basic data structures

    read the story with a b-repl
    connect algebra and geometry
